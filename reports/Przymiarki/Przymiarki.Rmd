---
title: "Pierwsze przymiarki"
output: html_notebook
---

```{r global_options, include = FALSE}
# Do not bother with this chunk because it only defines some visual options for other chunks
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE,
                      include = TRUE,
                      fig.align = "center",
                      fig.height = 3,
                      fig.width = 3,
                      verbose = FALSE)
    
```

```{r load_packages}
library(jsonlite)
library(tidyverse)
library(magrittr)
```

## ciganie tweet贸w

Nie wiem na ile u偶ywasz Twittera i znasz jego infrastruktur. Poni偶ej na przykadzie Przyw贸dcy Wolnego wiata omawiam rzeczy, kt贸re mo偶na wycign z Twittera. Zacznijmy od tego, 偶e tak naprawd s dwie podstawowe mo偶liwoci dostpu do tweet贸w. Po pierwsze mo偶na ciga je na bie偶co, po drugie mo偶na ciga historyczne tweety.

* `stream_tweets` - mo偶na wyszukiwa tweety po sowach kluczowych wystpujcych w tweecie (do 400 s贸w), po unikalnych numerach u偶ytkownik贸w (do 5000 u偶ytkownik贸w), po lokalizacji (mao u偶yteczne bo jednak spora cz ludzi nie udostpnia lokalizacji - gupi ludzie).
* `search_tweets` - mo偶na ciga tweety po sowach kluczowych (do 500 znak贸w) i po lokalizacji. Mo偶na wyszuka tweety do 10 dni wstecz, jednak i tak nie bd to wszystkie tweety tylko cz. Ci偶ko powiedzie jaka.

Poza tym jest par mo偶iwoci wycigania r贸偶nych rzeczy dotyczcych u偶ytkownik贸w czy te偶 czcych ich relacji. Jednak jest te偶 du偶o ogranicze, kt贸re powoduj, 偶e np. por贸wnanie zbioru oso贸b obserwujcych FOX News i CNN zajmie ze dwa tygodnie. Na razie chyba nie ma sensu si w to zagbia.

## Twitter

Nie wiem na ile wiesz czym si na przykad r贸偶ni cytat od retweeta. Dlatego poni偶ej przy okazji tego co mo偶na wycign z Twittera omawiam trzy podstawowe typy tweet贸w: tweet, retweet i cytat.

### tweet

W Twitterowej dokumentacji jest to okrelane statusem, ale ja wol sowo tweet. Poni偶ej przykad myli Przyw贸dcy Wolnego wiata. 

![](pics/tweet.png)   


Tak naprawd poza tym co wida mo偶na wycign mas ciekawych rzeczy z tweeta, poni偶ej opisane s waciwoci tweeta:   

* `user_id` - unikalny numer u偶ytkownia. W tym przypadku jest to 25073877.  
* `status_id` - unikalny numer tweeta. W tym przypadku jest to 1053121500151074817   
* `created_at` - kiedy tweet zosta stworzony. W przypadku retweeta jest to moment, w kt贸rym dany tweet zosta zretweetowany, wtedy nie ma znaczenia kiedy powsta orginalny tweet. Tutaj jest tylko napisane, 偶e powsta 10 godzin temu, ale przez API dostaj co do sekundy dat powstania - 2018-10-19 03:11:46
* `screen_name` - nazwa u偶ytkownika, kt贸ra musi by unikalna. W tym przypadku jest `@realDonaldTrump`. Jeli chodzi o Trumpa to jest tp do ciekawe, bo On ma swoje "prywatne" konto `@realDonaldTrump` oraz konto Prezydenta Stan贸w Zjednoczonych `@POTUS`. Normalnie u偶ywa swojego prywatnego konta, a to su偶bowe jest prowadzone chyba przez kogo innego. W zwizku z tym na tych kontach nie ma tego samego, to su偶bowe nie pisze a偶 takich gupot jak prywatne, ale oczywicie nikt na nie zwraca uwagi. Co moim zdaniem jest ciekawe to to, 偶e su偶bowe konto po tym jak Trump przestanie by prezydentem zmieni `screen_name` na `POTUS45`. Tak byo np. z Obam, kt贸ry zao偶y konto jako `POTUS`, a po tym jak przesta by prezydentem to Twitter stworzy Mu konto `BarackObama`, a Jego dotychczasowe tweety zostay zarchiwizowane na koncie `POTUS44`. Ze wszystkimi poprzednimi prezydentami byo tak samo.
* `name` - nazw u偶ytkownika. W tym przypadku jest to `Donald J. Trump`.   
* `text` - tre tweeta.
* `lang` - jzyk, w kt贸rym napisany jest tweet. Twitter automatycznie rozpoznaje je偶yk tweeta
* `source` - jaki klient zosta wykorzystany do stworzenia tweeta. Mo偶na w miar dokadnie powiedzie nie tylko czy u偶yto strony internetowej czy smartfona, ale te偶 czy by to telefon z Androidem czy IOSem. W tym przypadku by to Trumpa iPhone, kt贸rego najczciej u偶ywa do tweetowania, jednak czasem u偶ywa te偶 komputera. Z ostanich 100 Jego tweet贸w 95 byo z iPhone'a. Pozostae s stworzone przy u偶yciu Media Studio, kt贸re chyba su偶y do zarzdzania wieloma kontami, wic mo偶na wnioskowa, 偶e kto inny je stworzy.
* `is_quote` - czy ten tweet to jest cytat. W tym przypadku odpowied藕 brzmi nie.   
* `is_retweet` - czy ten tweet jest retweetem. W tym przypadku odpowied藕 brzmi nie.
* `favorite_count` - liczba polubie. W tym przypadku jest to 48 tysicy. Oczywicie z API jest dostaje si dokadn liczb nie przybli偶on tak jak tutaj. Jak sprawdziem w sobot to byo to ju偶 69636.
* `retweet_count` - liczba razy ten tweet by retweetowany. W tym przypadku jest to 14 tysicy, ale tak jak w przyapdku liczby polubie w API jest dokadna liczna. Jak sprawdziem w sobot to byo to ju偶 20628.
* `media_type` - format zacznika jeli oczywicie jest, tzn. czy jest to zdjcie, film itp. W tym przypadku to pole jest puste. Mo偶na wycignc te偶 link do tego zacznika.   
* `mentions_user_id` - unikalne numery u偶ytkownik贸w, kt贸rzy zostali wspomniani w tym tweecie. W tym przypadku nikt nie zosta wspomniany. Tutaj tak naprawde mo偶na rozr贸偶ni dwa r贸偶ne zachowania: odpowied藕 na czyj tweet lub wywoanie kogo poprzez umieszczenie czyjego `screen_name` w treci tweeta.
* `mentions_screen_name` - nazwy u偶ytkownik贸w, kt贸rzy zostali wspomniani w tweecie.  
* `reply_to_user_id` - unikalny numer u偶ytkownika do kt贸rego tweeta jest to odpowied藕.
* `reply_to_status_id` - unikalny numer tweeta, do kt贸rego ten tweet jest odpowiedzi.
* `reply_to_screen_name` - unikalna nazwa u偶ytkownika do kt贸rego to jest odpowied藕.
* `geo_coords`, `coords_coords` i `bbox_coords` - to s potencjalnie ciekawe dane za pomoc, kt贸rych mo偶na wyszukiwa tweety z danego miejsca. Jednak w wikszoci ludzie maj wyczon lokalizacj, wic moim zdaniem wyszukiwania tweet贸w po lokalizacji mija si z celem, bo dostaje si tylko tweety tych ludzi, kt贸rzy pozwalaj na lokalizacj.

Poza waciwociami samego tweeta mo偶na te偶 wycign waciwoci profilu. Poni偶ej to jak wyglda profil konta Przyw贸dcy Wolnego wiata.

![](pics/profile.png)   


Ju偶 z jednego tweeta Przyw贸dcy Wolnego wiata mo偶na wycign du偶o informacji na temat Jego profilu, daleko wicej ni偶 na zdjciu wy偶ej.

* `verified` - czy konto jest zweryfikowane. Osoby publiczne i dziennikarze czsto maj zweryfikowane konta, ale nie wszyscy. Wikszo zwykych ludzi ma niezweryfikowane, z tego co wiem to Twitter daje Ci tak mo偶liwo, a nie 偶e si o to aplikuje, ale nie dam gowy. W przypadku Donalda Trumpa ma zweryfikowane konto co wida po niebeiskim znaczku obok nazwiksa.
* `followers_count` - liczba os贸b obserwujcych profil u偶ytkownika. W tym przypadku jest to ponad 55 miliony, z API wyciga si oczywicie dokadn liczb - 55246656.
* `friends_count` - liczba os贸b, kt贸re profil obserwuje. Tutaj Twtitter nakada ograniczenie i u偶ytkownik mo偶e obserwowa maksymalnie 5 tysicy os贸b. W tym przypadku jest to 46 os贸b.
* `listed_count` - liczba list, kt贸rych u偶ytkownik jest czonkiem. W tym przypadku jest to 94936. Do listy mo偶na samemu doczy, albo inny u偶ytkownik mo偶e nas doczy. Tak naprawd myl, 偶e nie ma to 偶adnego znaczenia, bo jest to udogodnienie dla u偶ytkownika, kt贸ry chce zobaczy tylko tweety os贸b z listy.
* `statuses_count` - liczba tweet贸w stworzonych przez u偶ytkownika. Retweety te偶 si wliczaj jako tweety. W tym przypadku na ten moment jest to 39353.
* `favorites_count` - liczba polubonych tweet贸w. W tym przypadku jest to 26.
* `accounts_created_at` - kiedy konto zostao stworzone. W tym przypadku jest to marzec 2009, ale z API data jest dokadniejsza - 2009-03-18 13:46:38.
* `account_lang` - jzyk w jakim konto jest u偶ywane. Mo偶e to by o tyle ciekawa informacja, 偶e tak naprawd w jakim stopniu m贸wi na temat tego jaki jest pierwszy jzyk u偶ytkownika i w jakim jzyku ma ustawiony telefon czy komputer. Na przykad Tusk, kt贸ry ma dwa konta. Jedno oficjalne `@europresident`, a drugie `@donaldtusk` w obu ma ustawiony jzyk konta jako angielski, mimo 偶e w jednym tweetuje po angielsku, a w drugim po polsku. Cho jeli chodzi o swoje konto prywatne to tweetuje tylko z iPhone'a, a z oficjlanego z r贸偶nych urzdze. Skd mo偶na wysnu wniosek, 偶e nie zawsze tweety od `@europresident` pochodz od Donalda Tuska.
* `profile_banner_url` - link do zdjcia w tle. W tym przypadku jest to https://pbs.twimg.com/profile_banners/25073877/1540018811
* `profile_image_url` - link do zdjcia profilowego. W tym przypadku jest to http://pbs.twimg.com/profile_images/874276197357596672/kUuht00m_normal.jpg
* `url` - link podany przez u偶ytkownika. W tym przypadku do Instagrama http://www.Instagram.com/realDonaldTrump
* `location` - miejsce podane przez u偶ytkownika. W tym przypadku jest to Waszyngotn, DC. Wiesz, 偶e jest te偶 stan Waszyngton i jest on na zachodnim wybrze偶u?
* `description` - informacje podane przez u偶ytkownika. W tym przypadku jest to "45th President of the United States of America吼"
* `place_name`, `place_type`, `country`, `country_code` - teoretycznie to powinny by ciekawe dane dotyczce miejsca czy kraju pochodzenia profilu, ale jest to wpisane przez u偶ytkownika, wic rzadko kiedy jest tutaj cokolwiek wpisane.
* `protected` - czy konto jest og贸lnie dostpne czy nie. Jeli jest to pole przyjmuje warto prawda to znaczy, 偶e nie da si cign tweet贸w z tego konta, chyba, 偶e profil na kt贸rym jest postawiona aplikacja obserwuje dane konto. W naszym przypadku Andrzej nikogo nie obserwuje, wic nie. To jest og贸lnie do ciekawe, bo na Twitterze mo偶na ludzi blokowa tak, 偶e nie widz tworzonych przez nas tweet贸w. Jednak czy np. oficjalny profil Prezydenta Stan贸w Zjednoczonych mo偶e kogo zablokowa ograniczaj w ten spos贸b dostp do wiatych myli Przyw贸dcy Wolnego wiata? Sd federalny ostatnio zdecydowa, 偶e Trump nie mo偶e nikogo zablokowa dop贸ki jest prezydentem.

### retweet

Jest to podanie czyjego tweeta osobom, kt贸re obserwuj nasze konto. Poni偶ej przykad.

![](pics/retweet.png)


Na temat retweeta mo偶na wycign dokadnie te same informacje co na temat tweeta. Co wicej mo偶na te偶 wycign informacje na temat konta, kt贸re stworzyo oryginalnego tweeta. Tzn. cigajc tego tweeta dostajemy informacje nie tylko na temat Przyw贸dcy Wolnego wiata, ale te偶 na temat U.S. Marines

### quote

Jest to tak naprawd podanie dalej czyjego tweeta wraz z wasnym komentarzem. Przykad poni偶ej.

![](pics/quote.png)


Przez API dostajemy wszystkie mo偶liwe informacje na temat tweeta Przyw贸dcy Wolnego wiata oraz tweeta Karli Zabs. Dodatkowo wszystkie mo偶liwe informacje na temat ich profili.

## Kler

Tak jak napisaem w mailu. Zebraem troch historycznych tweet贸w i zaczem te偶 ciga tweety na bie偶co. W obu przypadkach wyszukuje tweety po nastpujcych sowach kluczowych: `r read.csv2("../../words.csv") %$% word`. Tzn. poprzednie zdanie jest prawie prawdziwe bo w ciganiu na bie偶co dodaem polexit i POLEXIT. Ju偶 dawno chciaem to ciga, ale jako nie byo okazji. To co jest poni偶ej dotyczy tylko tweet贸w historycznych o klerze.

### Przetwarzanie danych

Og贸lnie zebbraem 131178 tweet贸w, jednak mam wra偶enie, 偶e kilkukrotnie zebray si te same najwie偶sze. Tzn. jestem o tym przekonany na 90% bo powtarzaj sie `status_id`, kt贸re powinny by unikalne nawet dla retweet贸w. Jest to g贸wnie spowodowane tym, 偶e Twitter nie bardzo chce dawa dostp do historycnych tweet贸w, bo chce na tym zarabia. Jak si przefiltruje w ten spos贸b, 偶eby byy tylko unikalne tweety to jest ich 48305, z czego 29867 to retweety.

```{r load_data}
kler <- stream_in(file("../../data/kler.jl")) %>%
  distinct(status_id,.keep_all = TRUE)
```

```{r frequency_plot}
kler %>% 
  group_by(is_retweet) %>%
  rtweet::ts_plot("1 hour") +
  theme_classic() +
  scale_color_discrete("",labels=c("Orginal","Retweet")) +
  labs(
    x = NULL, y = NULL,
    title = "Czsto tweet贸w od 7 grudnia",
    subtitle = "Tweety s zaagregowane w godzinnych interwaach",
    caption = "\nSource: Data collected from Twitter's REST API via rtweet")
```

<!-- CSS styling -->
<style>
    html {
        height: 100%;
        font-size: 62.5%;
    }
    body {
        text-align: justify;
        height: 100%;
        font-size: 1.6em;
        font-family: "Trebuchet MS", "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", sans-serif;
    }
    h1, h2, h3 {
        text-align: left;
    }
    h4.author, h4.date {
        margin: 0.75em 0 0 0;
        text-align: center;
    }
    h2, h3, h4, h5, h6 {
        margin: 2em 0 1em 0;
    }
    div#header {
        margin: 1em 0 1em 0;
    }
    hr {
        margin: 2em 0 2em 0;
    }
    pre {
        margin-bottom: 2em;
    }
</style>