---
title: "Przymiarki"
output:
  html_notebook:
    toc: yes
runtime: shiny
---

```{r global_options, include = FALSE}
# Do not bother with this chunk because it only defines some visual options for other chunks
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      include = FALSE,
                      fig.align = "center",
                      fig.height = 3,
                      fig.width = 3,
                      verbose = FALSE)
    
```

```{r load_packages}
library(jsonlite)
library(tidyverse)
library(magrittr)
library(quanteda)
library(stringr)
library(RColorBrewer)
library(lubridate)
library(rtweet)
library(tidytext)
library(shiny)
```

## ciganie tweet贸w

Nie wiem na ile u偶ywasz Twittera i znasz jego infrastruktur. Poni偶ej na przykadzie Przyw贸dcy Wolnego wiata kr贸tkie om贸wienie rzeczy, kt贸re mo偶na wycign z Twittera. Zacznijmy od tego, 偶e tak naprawd s dwie podstawowe mo偶liwoci dostpu do tweet贸w. Po pierwsze mo偶na ciga je na bie偶co, po drugie mo偶na ciga historyczne tweety.

* `stream_tweets` - tweety mo偶na wyszukiwa na trzy sposoby: po sowach kluczowych (do 400 s贸w), po unikalnych numerach u偶ytkownik贸w (do 5000 u偶ytkownik贸w), po lokalizacji (mao u偶yteczne bo jednak spora cz ludzi nie udostpnia lokalizacji - gupi ludzie).

* `search_tweets` - mo偶na ciga tweety po sowach kluczowych (do 500 znak贸w) i po lokalizacji. Mo偶na wyszuka tweety do 10 dni wstecz, jednak i tak nie bd to wszystkie tweety tylko cz. Ci偶ko powiedzie jaka.

Poza tymi dwoma podstawowymi sposobami mo偶na wyciga jeszcze informacje dotyczce relacji czcych u偶ytkownik贸w. Niestety, jest troch ogranicze z tym zwizanych, kt贸re powoduj, 偶e np. por贸wnanie zbioru os贸b obserwujcych FOX News i CNN zajmie ze dwa tygodnie...

## Twitter

Nie wiem na ile wiesz czym si na przykad r贸偶ni quote od retweeta. Dlatego poni偶ej przy okazji tego co mo偶na wycign z Twittera trzy podstawowe typy tweet贸w: tweet, retweet i quote

### tweet

Tak naprawd w Twitterowej dokumentacji pr贸偶no szuka sowa tweet, to co wszyscy nazywaj tweetem jest tam okrelane mianem statusu. Jednak ja dalej bd zawsze pisa tweet, bo jest mi po prostu tak wygodniej. Poni偶ej wic przykad tego jak wyglda tweet z poziomu zwykego u偶ytkownika.

![](pics/tweet.png)   


To co wida powiedziabym, 偶e nie jest specjalnie ciekawe i nie jest te偶 tego za du偶o. To co jest ju偶 ciekawsze mo偶na bez trudu wycign z API:   

* `user_id` - unikalny numer u偶ytkownika. W tym przypadku jest to $25073877$. Przydatne jak si chce sprawdza co innego dany u偶ytkownik napisa.  

* `status_id` - unikalny numer tweeta. Ka偶dy tweet ma sw贸j oddzielny numer niezale偶nie od tego czy jest tweetem, retweetem czy quotem, ale o tym za moment. W tym przypadku jest to $1053121500151074817$.

* `created_at` - moment w kt贸rym dany tweet zosta zatweetowany. W przypadku retweeta jest to moment, w kt贸rym dany tweet zosta zretweetowany; nie ma znaczenia kiedy powsta oryginalny tweet. Tutaj jest tylko napisane, 偶e powsta 10 godzin temu, ale przez API dostaj co do sekundy dat powstania - 2018-10-19\ 03:11:46.

* `screen_name` - nazwa u偶ytkownika, kt贸ra musi by unikalna. W tym przypadku jest to `@realDonaldTrump`. Jeli chodzi o Trumpa to to jest do ciekawe, bo On ma swoje "prywatne" konto `@realDonaldTrump` oraz konto Prezydenta Stan贸w Zjednoczonych `@POTUS`. Normalnie u偶ywa swojego prywatnego konta, a to su偶bowe jest prowadzone chyba przez kogo innego. W zwizku z tym na tych kontach nie ma tego samego; to su偶bowe nie pisze a偶 takich gupot jak prywatne, ale oczywicie nikt na nie nie zwraca uwagi. Ciekawe jest to, 偶e su偶bowe konto po tym jak Trump przestanie by prezydentem zmieni `screen_name` na `@POTUS45`. Tak byo np. z Obam, kt贸ry zao偶y konto `@POTUS`, a po tym jak przesta by prezydentem to Twitter stworzy Mu konto `@BarackObama`. Jego dotychczasowe tweety zostay zarchiwizowane na koncie `@POTUS44`. Ze wszystkimi poprzednimi prezydentami byo tak samo.

* `name` - nazwa u偶ytkownika. W tym przypadku jest to `Donald J. Trump`.

* `text` - tre tweeta. To pole jak rozumiem bdzie nas najbardziej interesowa. 

* `lang` - jzyk, w kt贸rym napisany jest tweet. Jest automatycznie rozpoznawany przez Twittera.

* `source` - jaki klient zosta wykorzystany do stworzenia tweeta. Mo偶na w miar dokadnie powiedzie nie tylko czy u偶yto strony internetowej czy smartfona, ale te偶 czy by to telefon z Androidem czy IOSem. W tym przypadku by to Trumpa iPhone, kt贸rego najczciej u偶ywa do tweetowania, cho czasem u偶ywa te偶 komputera. Z ostatnich 100 Jego tweet贸w 95 byo z iPhone'a, a tylko 5 z komputera przy u偶yciu Media Studio, kt贸re su偶y do zarzdzania wieloma kontami. Mo偶na wic wnioskowa, 偶e niekoniecznie napisa go przy pomocy swoich maych doni.

* `is_quote` - czy ten tweet to jest cytat. W tym przypadku odpowied藕 brzmi nie.   

* `is_retweet` - czy ten tweet jest retweetem. W tym przypadku odpowied藕 brzmi nie.

* `favorite_count` - liczba polubie. Na zdjciu jest tylko przybli偶ona warto, jak je robiem to nie sprawdziem od razu ile jest ich naprawd, a jak sprawdziem przez API w sobot to byo ich ju偶 $69636$.

* `retweet_count` - liczba razy ten tweet by retweetowany. Tak samo jak w przypadku liczby polubie jest tylko przybli偶ona i te偶 jej nie sprawdziem od razu w API, w sobot byo to ju偶 $20628$.

* `media_type` - format zacznika jeli oczywicie jest, tzn. czy jest to zdjcie, film itp. W tym przypadku to pole jest puste. Mo偶na wycign te偶 link do tego zacznika.   

* `mentions_user_id` - unikalne numery u偶ytkownik贸w, kt贸rzy zostali wspomniani w tym tweecie. W tym przypadku nikt nie zosta wspomniany. Tutaj warto wspomnie o dw贸ch r贸偶nych zachowaniach u偶ytkownik贸w z kt贸rych mo偶e wynika to, 偶e jaki inny u偶ytkownik jest wspomniany w tweetcie: tweet jest odpowiedzi na czyj tweet lub jest wywoaniem kogo.

* `mentions_screen_name` - nazwy u偶ytkownik贸w, kt贸rzy zostali wspomniani w tweecie.  

* `reply_to_user_id` - unikalny numer u偶ytkownika do kt贸rego tweeta jest to odpowied藕.

* `reply_to_status_id` - unikalny numer tweeta, do kt贸rego ten tweet jest odpowiedzi.

* `reply_to_screen_name` - unikalna nazwa u偶ytkownika do kt贸rego to jest odpowied藕.

* `geo_coords`, `coords_coords` i `bbox_coords` - to s potencjalnie ciekawe dane za pomoc, kt贸rych mo偶na wyszukiwa tweety z danego miejsca. Jednak w wikszoci ludzie maj wyczon lokalizacj, wic moim zdaniem wyszukiwania tweet贸w po lokalizacji mija si z celem, bo dostaje si tylko tweety tych ludzi, kt贸rzy pozwalaj na lokalizacj.

cigajc przez API jednego tweeta dostaje si nie tylko informacje dotyczce samego tweeta, ale te偶 mn贸stwo informacji na temat u偶ytkownika, kt贸ry go stworzy. Poni偶ej to jak wyglda profil konta Przyw贸dcy Wolnego wiata z poziomu zwykego u偶ytkownika.

![](pics/profile.png)   


Tak jak w przypadku tweeta, to co wida nie jest przesadnie ciekawe, du偶o ciekawsze jest to co zwraca API:

* `verified` - czy konto jest zweryfikowane. Osoby publiczne i dziennikarze czsto maj zweryfikowane konta, ale nie jest to regu. Z tego co wiem to Twitter daje Ci mo偶liwo weryfikacji konta, a nie 偶e si o to aplikuje. W przypadku Donalda Trumpa ma On zweryfikowane konto co wida po niebieskim znaczku obok nazwiska.

* `followers_count` - liczba os贸b obserwujcych profil u偶ytkownika. Tak jak w przypadku tweeta na zdjciu wida mniej ni偶 w API, kt贸re podaje dokadn liczb - $55246656$.

* `friends_count` - liczba os贸b, kt贸re profil obserwuje. Dobrze wiedzie, 偶e Twitter nakada ograniczenia na liczb os贸b, kt贸re mo偶na obserwowa - jest to maksymalnie 5 tysicy kont. W tym przypadku Trump obserwuje tylko 46 os贸b (FOX and Family).

* `listed_count` - liczba list, kt贸rych u偶ytkownik jest czonkiem. Do listy mo偶na samemu doczy, albo zosta doczonym przez innego u偶ytkownika. Tak naprawd listy nie maj 偶adnego znaczenia, bo g贸wnie su偶 do uporzdkowania wywietlajcych si tweet贸w. W tym przypadku jest to $94936$.

* `statuses_count` - liczba tweet贸w stworzonych przez u偶ytkownika (retweety te偶 si wliczaj). W tym przypadku jest to $39353$.

* `favorites_count` - liczba polubionych tweet贸w. W tym przypadku jest to $26$.

* `accounts_created_at` - kiedy konto zostao stworzone. Na zdjciu jest tylko przybli偶ona data z API mo偶na wycign dat co do sekundy - 2009-03-18 13:46:38.

* `account_lang` - jzyk w jakim konto jest u偶ywane. Mo偶e to by o tyle ciekawa informacja, 偶e tak naprawd w jakim stopniu m贸wi na temat tego jaki jest pierwszy jzyk u偶ytkownika i w jakim jzyku ma ustawiony telefon czy komputer. Na przykad Tusk, kt贸ry ma dwa konta: jedno oficjalne `@europresident`, a drugie `@donaldtusk` w obu ma ustawiony jzyk konta jako angielski. Mimo 偶e tak naprawd na jednym tweetuje po angielsku, a na drugim po polsku. Cho jeli chodzi o konto prywatne to tweetuje tylko z iPhone'a, a z oficjalnego z r贸偶nych urzdze. Std mo偶na wysnu wniosek, 偶e nie zawsze tweety od `@europresident` pochodz od Donalda Tuska, prawdopodobnie cz z nich jest pisana przez kogo innego.

* `profile_banner_url` - link do zdjcia w tle. W tym przypadku link do zdjciach jest [tutaj.](https://pbs.twimg.com/profile_banners/25073877/1540018811)

* `profile_image_url` - link do zdjcia profilowego. W tym przypadku link do zdjcia jest [tutaj.](http://pbs.twimg.com/profile_images/874276197357596672/kUuht00m_normal.jpg)

* `url` - link podany przez u偶ytkownika. W tym przypadku jest to link do profilu Trumpa na [Instagramie.](http://www.Instagram.com/realDonaldTrump)

* `location` - miejsce podane przez u偶ytkownika. W tym przypadku jest to Waszyngton, DC. Wiesz, 偶e jest te偶 stan Waszyngton i jest on na zachodnim wybrze偶u?

* `description` - informacje podane przez u偶ytkownika. W tym przypadku jest to "45th President of the United States of America吼"
* `place_name`, `place_type`, `country`, `country_code` - teoretycznie to powinny by ciekawe dane dotyczce miejsca czy kraju pochodzenia profilu, ale jest to wpisane przez u偶ytkownika, wic rzadko kiedy jest tutaj wpisane co ciekawego.

* `protected` - czy konto jest og贸lnie dostpne czy nie. Jeli konto jest chronione to znaczy, 偶e nie da si cign z niego tweet贸w, chyba, 偶e profil na kt贸rym jest postawiona aplikacja obserwuje dane konto (w naszym przypadku Andrzej nikogo nie obserwuje, wic jest dostp tylko do kont publicznych). Jednak tak naprawd kont prywatnych wcale nie jest du偶o, wikszo jest publicznych og贸lnie dostpnych. To jest og贸lnie do ciekawe, bo na Twitterze mo偶na ludzi blokowa tak, 偶e nie widz tworzonych przez nas tweet贸w. Jednak jako ostatnio Sd Federalny orzek, 偶e Trump jako Przyw贸dca Wolnego wiata i Prezydent Stan贸w Zjednoczonych nie mo偶e blokowa u偶ytkownik贸w, bo w ten spos贸b ograniczaby dostp do informacji publicznej.

### retweet

Jest to podanie czyjego tweeta osobom, kt贸re obserwuj nasze konto, a niekoniecznie obserwju konto osoby, kt贸ra napisaa oryginalnego tweeta. Czsto u偶ytkownicy w opisach swoich profili maj napisane, 偶e retweet nie oznacza poparcia. Poni偶ej przykad.

![](pics/retweet.png)


W przypadku retweeta dostajemy wszystkie te same informacje, kt贸re poprzednio dostalimy o tweecie. Jednak Twitter retweet uznaje jako tweet, wic np. `created_at` bdzie to moment, w kt贸rym Trump retweetowa tego tweeta. Tak samo bdzie z `name` czy te偶 `source`. Szczliwie Twitter dostarcza te偶 informacje o oryginalnym tweecie U.S. Marines: `retweet_created_at`, `retweet_screen_name`, `retweet_source` i `retweet_status_id`. Poza tym dostajemy te偶 troch informacji na temat konta U.S. Marines: `retweet_user_id`, `retweet_statuses_count`, `retweet_followers_count`, `retweet_friends_count` i `retweet_description`. Moim zdaniem jedyna ciekawa rzecz, kt贸rej nie dostajemy to jzyk w jakim prowadzone jest konto U.S. Marines. Mo偶na to wycign ale ju偶 bezporednio z konta U.S. Marines co przy wikszej liczbie u偶ytkownik贸w jest czasochonne.

### quote

Jest to tak naprawd podanie dalej czyjego tweeta wraz z wasnym komentarzem. Przykad poni偶ej.

![](pics/quote.png)


Dla Twittera tak naprawd quote nie r贸偶ni si za bardzo od zwykego tweeta. Przez API dostajemy wszystkie mo偶liwe informacje na temat tweeta Przyw贸dcy Wolnego wiata i jego konta. Dodatkowo dostajemy te偶 troch informacji na temat cytowanego tweeta: `quoted_text`, `quoted_created_at`, `quoted_screen_name`, `quoted_source`, `quoted_status_id`, `quoted_favorite_count`, `quoted_retweet_count`. Poza tym dostajemy te偶 troch informacji na temat konta Karli Zabs: `quoted_user_id`, `quoted_statuses_count`, `quoted_followers_count`, `quoted_friends_count`, `quoted_description` i `retweet_favorites_count`. Tak samo jak w przypadku retweeta brakuje jedynie infromacji na temat jzyka w jakim prowadzone jest konot Karli Zabs.

## Kler

Tak jak napisaem w mailu. Zebraem troch historycznych tweet贸w i zaczem te偶 ciga tweety na bie偶co. W obu przypadkach wyszukuje tweety po nastpujcych sowach kluczowych: `r read.csv2("../../words.csv") %$% word`. Tzn. poprzednie zdanie jest prawie prawdziwe bo dopiero w ciganiu na bie偶co dodaem polexit i POLEXIT. Ju偶 dawno chciaem to ciga, ale jako nie byo okazji. To co jest poni偶ej dotyczy tylko tweet贸w historycznych o klerze.

### Przetwarzanie danych

Og贸lnie zebraem $131178$ tweet贸w, jednak  przez to, 偶e dostp do historycznych tweet贸w jest ograniczony kilkukrotnie zebray si te same. Jest to  spowodowane tym, 偶e Twitter nie bardzo chce dawa dostp do historycznych tweet贸w, bo chce na tym zarabia. Po przefiltrowaniu powtarzajcych si tweet贸w zostao ich $48305$, z czego $29867$ to retweety.

```{r load_data, cache = TRUE}
kler <- stream_in(file("../../data/kler.jl")) %>%
  distinct(status_id,.keep_all = TRUE) %>%
  mutate(id = status_id) %>%
  corpus(text_field = "text",
         docid = "id")
```

Drugim filtrem, kt贸ry zastosowaem byo wybranie tylko tych s贸w, kt贸re rzeczywicie nas interesuj. Przez takie a nie inne ustawienia s贸w kluczowych zebray si te偶 tweety dotyczce na przykad Marka Jakubiaka - kandydata na prezydenta Warszawy z Kukiz15 czy te偶 rocznicy mierci ksidza Jerzego Popieuszki. Innymi sowy jest wicej tweet贸w ni偶 potrzeba, dlatego z tych $48305$ przefiltrowaem na razie tylko te, kt贸re explicite dotycz kleru czyli zawieraj sowa: kler, ksidz, ksi偶a, ks., biskup, arcybiskup, koci贸, kosciol, ksiadz, ksieza, smarzowski, gajos, kulik, jakubik, braciak, wieckiewicz i wickiewicz.

```{r corpus_select}
WORDS <- c("kler",
           "ksidz",
           "ksi偶a",
           " ks.",
           "biskup",
           "arcybiskup",
           "koci贸",
           "kosciol",
           "ksiadz",
           "ksieza",
           "smarzowski",
           "gajos",
           "kulik",
           "jakubik",
           "wieckiewicz",
           "wickiewicz",
           "braciak")

kler_id <- kler %>%
  kwic(pattern = WORDS,
       case_insensitive = TRUE) %$%
  docname

kler <- kler %>% 
  corpus_subset(status_id %in% kler_id)

tokens <- kler %>%
  tokens(what = "word",
         remove_numbers = TRUE,
         remove_punct = TRUE,
         remove_symbols = TRUE,
         remove_separators = TRUE,
         remove_twitter = TRUE,
         remove_url = TRUE,
         include_docvars = TRUE)
```

### Przykady

```{r examples}
most_likes <- kler %>%
  docvars() %>%
  arrange(desc(favorite_count)) %>%
  slice(1) %$%
  status_id

most_retweets <- kler %>%
  docvars() %>%
  arrange(desc(retweet_count)) %>%
  slice(1) %$%
  status_id
```

Tak, 偶eby miaa jakikolwiek obraz tego jak te tweety wygldaj to poni偶ej s dwa przykadowe tweety z tych zebranych: pierwszy to tweet o najwikszej liczbie polubie, a drugi o najwikszej liczbie retweet贸w.

Tweet o najwikszej liczbie polubie - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% favorite_count`:

> `r kler %>% corpus_subset(status_id %in% most_likes) %>% texts()`

Poni偶ej podstawowe informacje zar贸wno na temat tego tweeta jak i osoby, kt贸ra go stworzya. Najpierw podstawowe informacje dotyczce samego tweeta:

* `created_at` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% created_at`
* `name` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% name`
* `source` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% source`
* `retweet_count` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% retweet_count`
* `is_retweet` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% is_retweet`
* `is_quote` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% is_quote`

Podstawowe informacje na temat u偶ytkownika:

* `account_created_at` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% account_created_at`
* `account_lang` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% account_lang`
* `statuses_count` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% statuses_count`
* `followers_count` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% followers_count`
* `friends_count` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% friends_count`
* `description` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% description`
* `favorites_count` - `r kler %>% docvars() %>% filter(status_id == most_likes) %$% favorite_count`

Tweet najczciej retweetowany - `r kler %>% docvars() %>% filter(status_id == most_retweets) %$% retweet_count`:

> `r kler %>% corpus_subset(status_id %in% most_retweets) %>% texts() %>% str_replace_all(pattern = "\\\n", replacement = " ")`

Poni偶ej podstawowe informacje zar贸wno na temat tego tweeta jak i osoby, kt贸ra go stworzya. Najpierw podstawowe informacje dotyczce samego tweeta:

* `retweet_created_at` - `r kler %>% docvars() %>% filter(status_id == most_retweets) %$% retweet_created_at`
* `retweet_screen_name` - `r kler %>% docvars() %>% filter(status_id == most_retweets) %$% retweet_screen_name`
* `retweet_source` - `r kler %>% docvars() %>% filter(status_id == most_retweets) %$% retweet_source`
* `retweet_retweet_count` - `r kler %>% docvars() %>% filter(status_id == most_retweets) %$% retweet_retweet_count`

Podstawowe informacje na temat u偶ytkownika:

* `retweet_statuses_count` - `r kler %>% docvars() %>% filter(status_id == most_retweets) %$% retweet_statuses_count`
* `retweet_followers_count` - `r kler %>% docvars() %>% filter(status_id == most_retweets) %$% retweet_followers_count`
* `retweet_friends_count` - `r kler %>% docvars() %>% filter(status_id == most_retweets) %$% retweet_friends_count`
* `retweet_description` - `r kler %>% docvars() %>% filter(status_id == most_retweets) %$% retweet_description`
* `retweet_favorites_count` - `r kler %>% docvars() %>% filter(status_id == most_retweets) %$% retweet_favorite_count`

Wida, wic, 偶e o ile tweet z najwiksz liczb polubie jest midzy 7 i 17 pa藕dziernika to ten najczstszy retweet jest z pierwszego weekendu pokazywania kleru w kinach.

### Wykresy

Tak naprawd to s do proste wykresy, bo wymylenie liczenia sentymentu wcale nie jest takie trywialne, tzn. teoretycznie jest LIWC, ale z tego co mi si wydaje to on nie jest taki atwy w dostpie. Co postaram si wymyli. Na razie spokojnie dalej si zbieraj tweety.

```{r frequency_plot, include = TRUE, message = FALSE}
kler %>%
  kwic(pattern = WORDS,
       case_insensitive = TRUE,
       window = 1) %>% 
  as_tibble() %>%
  select(status_id = docname, keyword) %>%
  left_join(kler %>% docvars %>% select(status_id, created_at)) %>%
  mutate(keyword = tolower(keyword)) %>%
  mutate(keyword = case_when(keyword == "ksiadz" ~ "ksidz",
                             keyword == "kosciol" ~ "koci贸",
                             keyword == "ksieza" ~ "ksi偶a",
                             TRUE ~ keyword),
         created_at = created_at %>% as.character %>% ymd_hms()) %>%
  filter(keyword %in% c("kler", "ksidz", "ksi偶a", "ks.", "biskup", "arcybiskup", "koci贸", "smarzowski", "gajos", "kulik", "jakubik", "braciak", "wickiewicz")) %>%
  group_by(keyword) %>%
  ts_plot("12 hours") +
  theme_classic() +
  scale_color_discrete("") +
  labs(x = NULL, y = NULL,
    title = "Czsto tweet贸w na temat kleru od 7 do 17 pa藕dziernika",
    subtitle = "Tweety s zaagregowane w 12 godzinnych interwaach",
    caption = "") 
```

```{r 9_paz}
end <- ymd_hms("2018-10-09 23:59:59")
start <- ymd_hms("2018-10-09 00:00:00")
paz_most_retweets <- kler %>%
  corpus_subset(created_at > start) %>%
  corpus_subset(created_at < end) %>%
  docvars() %>%
  group_by(retweet_status_id) %>%
  summarise(freq = n()) %>%
  filter(!is.na(retweet_status_id)) %>%
  arrange(desc(freq)) %>%
  slice(1) %$%
  retweet_status_id
```

Pierwsza rzecz, kt贸ra oczywicie rzuca si w oczy to du偶y pik sowa ksidz 9 pa藕dziernika, zwaszcza, 偶e to by wtorek. Kler w kinach by ju偶 od przeszo tygodnia (premiera 28 wrzenia). Poni偶ej tweet, kt贸ry by najczciej retweetowany 9 pa藕dziernika:

> `r kler %>% corpus_subset(status_id %in% paz_most_retweets) %>% texts()`

Szczerze m贸wic nie bardzo rozumiem czemu 9 pa藕dziernika zrobi a偶 tak furor, 偶e zosta `r kler %>% corpus_subset(created_at > start) %>% corpus_subset(created_at < end) %>% docvars() %>% group_by(retweet_status_id) %>% summarise(freq = n()) %>% filter(!is.na(retweet_status_id)) %>% arrange(desc(freq)) %>% slice(1) %$% freq` razy retweetowany. Nie jest to jako przesadnie mieszne. To jest ten sam tweet, kt贸ry ma najwicej polubie midzy 7 pa藕dziernika, a 17. Mimo 偶e ten jeden tweet wyjania ten peak to co innego musiao si te偶 zdarzy 9 pa藕dziernika, bo on nie jest przesadnie mieszny. Na pewno za to 7 pa藕dziernika zostaa opublikowana ["mapa kocielnej pedofili w Polsce"](http://nielekajciesie.org.pl/news75-Mapa_koscielnej_pedofili_w_Polsce) przez fundacje "Nie lkajcie si", ale nie wydaje mi si, 偶eby to z tym byo zwizane.

```{r 8_paz}
end8 <- ymd_hms("2018-10-08 23:59:59")
start8 <- ymd_hms("2018-10-08 00:00:00")
paz8_most_retweets <- kler %>%
  corpus_subset(created_at > start8) %>%
  corpus_subset(created_at < end8) %>%
  docvars() %>%
  group_by(retweet_status_id) %>%
  summarise(freq = n()) %>%
  filter(!is.na(retweet_status_id)) %>%
  arrange(desc(freq)) %>%
  slice(1) %$%
  retweet_status_id
```

Druga rzecz, kt贸ra zwr贸cia moj uwag to to, 偶e 8 pa藕dziernika m贸wio si stosunkowo du偶o klerze i jakubiku. Stawiam na to, 偶e zwizane to byo z tym, 偶e to by poniedziaek po drugim weekendzie pokazywania tego filmu, wic pojawiy si wyniki ogldalnoci. W jakim stopniu potwierdza to najczciej retweetowany tweet tego dnia (`r kler %>% corpus_subset(created_at > start8) %>% corpus_subset(created_at < end8) %>% docvars() %>% group_by(retweet_status_id) %>% summarise(freq = n()) %>% filter(!is.na(retweet_status_id)) %>% arrange(desc(freq)) %>% slice(1) %$% freq`)

> `r kler %>% corpus_subset(status_id %in% paz8_most_retweets) %>% texts()`

Og贸lnie problem jest tylko taki, 偶e ci偶ko w przypadku historycznych tweet贸w opiera si na frekwencji bo nie s to wszystkie tweety z tego okresu, tylko do losowa ich pr贸bka. Tzn. teoretycznie to powinna by mieszanka napopularniejszych i najwie偶szych.

To co jeszcze zrobiem to zaagregowaem tweety po dniach i sprawdziem z grubsza rozkad s贸w w nich wystpujcy. Oczywicie trudno wypatrze tam co ciekawego bo tak jak pisaem na samym pocztku musz si dobrze zastanowi jak upora si z jzykiem polskim... Na razie do arbitralnie usunem sowa, kt贸re nic nie wnosz czyli: `r c("jest", "gdzie", "si", "sie", "tego", "maj", "maja", "ale", "chce","dla", "jednak", "tylko", "niej", "kt贸ry", "ktory", "albo", "jak", "innego", "ca", "bierze", "wr贸d", "mimo", "jeli", "czy", "mnie", "wam", "tym", "cae", "przed", "naprawd", "wojciech", "dosadniej", "dalej", "ka偶dy", "jego")`

```{r aggregate, include = TRUE, message = FALSE}
tokens %>%
  docvars() %>%
  mutate(created_at = created_at %>% ymd_hms() %>% day) %>%
  select(status_id, created_at) %>%
  left_join(tokens %>% dfm() %>% tidy() %>% rename(status_id = document)) %>%
  filter(nchar(term) > 2) %>%
  group_by(created_at, term) %>%
  summarise(count = sum(count)) %>%
  group_by(created_at) %>%
  mutate(count = count/sum(count)) %>%
  ungroup() %>%
  mutate(term = case_when(term == "ksiadz" ~ "ksidz",
                          term == "kosciol" ~ "koci贸",
                          term == "ksieza" ~ "ksi偶a",
                          term == "wieckiewicz" ~ "wickiewicz",
                          TRUE ~ term)) %>%
  anti_join(data_frame(term = c("jest", "gdzie", "si", "sie", "tego", "maj", "maja", "ale", "chce","dla", "jednak", "tylko", "niej", "kt贸ry", "ktory", "albo", "jak", "innego", "ca", "bierze", "wr贸d", "mimo", "jeli", "czy", "mnie", "wam", "tym", "cae", "przed", "naprawd", "wojciech", "dosadniej", "dalej", "ka偶dy", "jego"))) %>%
  group_by(created_at) %>%
  arrange(desc(count)) %>%
  slice(1:10) %>%
  ggplot(aes(x = term,
             y = count,
             fill = as.factor(created_at))) +
  facet_wrap(~created_at, scales = "free_y") +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  theme_classic() +
  labs(x = NULL, y = NULL,
    title = "Prawdopodobiestwa wystpowania kluczowych s贸w w tweetach",
    subtitle = "Tweety zebrane midzy 7, a 17 pa藕dziernika",
    caption = "") 
  
```

Kolejn rzecz, kt贸r zrobiem byo policzenie inverse document frequency, na podstawie, kt贸rego mo偶na zobaczy jakie sowa s specyficzne dla danego dnia. Jest to do proste bo wzr贸j jest nastpujcy:

$$idf(word)=ln(\frac{n_{documents}}{n_{document\ contatining\ word}})$$ 
gdzie $n_{documents}$ to liczba dokument贸w, a $n_{number\ containing\ word}$ - liczba dokument贸w zawirajacych dane sowo.

```{r idf}
tokens %>%
  docvars() %>%
  mutate(created_at = created_at %>% ymd_hms() %>% day) %>%
  select(status_id, created_at) %>%
  left_join(tokens %>% dfm() %>% tidy() %>% rename(status_id = document)) %>%
  filter(nchar(term) > 2) %>%
  group_by(created_at, term) %>%
  summarise(count = sum(count)) %>%
  group_by(created_at) %>%
  ungroup() %>%
  mutate(term = case_when(term == "ksiadz" ~ "ksidz",
                          term == "kosciol" ~ "koci贸",
                          term == "ksieza" ~ "ksi偶a",
                          term == "wieckiewicz" ~ "wickiewicz",
                          TRUE ~ term)) %>%
  bind_tf_idf(term = term,
              document = created_at,
              n = count) %>%
  filter(idf==max(idf)) %>%
  select(created_at, term, tf) %>%
  group_by(created_at) %>%
  arrange(desc(tf)) %>%
  slice(1:10) %>%
  ggplot(aes(x = term,
             y = tf,
             fill = as.factor(created_at))) +
  facet_wrap(~created_at, scales = "free_y") +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  theme_classic() +
  labs(x = NULL, y = NULL,
    title = "Prawdopodobiestwo 10 najczstszych specyficznych s贸w dla ka偶dego dnia",
    subtitle = "Tweety zebrane midzy 7, a 17 pa藕dziernika",
    caption = "") 

```

Jedyne co mo偶na tutaj zobaczy, a w zasadzie czego nie ma to sowa po kt贸rych wyszukiwalimy. Powiedziabym, 偶e niewprost pokazuje, 偶e rzeczywicie ka偶dego dnia pojawiay si tweety na temat kocioa czy te偶 kleru.

Tak naprawd to tego idf u偶ywa si do liczenia term frequency inverse document frequency, czyli po prostu liczenia wa偶onej czstoci.

```{r tf_idf}
table <- tokens %>%
  docvars() %>%
  mutate(created_at = created_at %>% ymd_hms() %>% day) %>%
  select(status_id, created_at) %>%
  left_join(tokens %>% dfm() %>% tidy() %>% rename(status_id = document)) %>%
  filter(nchar(term) > 2) %>%
  mutate(term = case_when(term == "ksiadz" ~ "ksidz",
                          term == "koosciol" ~ "koci贸",
                          term == "ksieza" ~ "ksi偶a",
                          term == "wieckiewicz" ~ "wickiewicz",
                          TRUE ~ term)) %>%
  group_by(term, created_at) %>%
  summarise(count = sum(count)) %>%
  bind_tf_idf(term = term, document = created_at, n = count) %>%
  select(created_at, term, tf) %>%
  mutate(created_at = paste0("paz",created_at)) %>%
  ungroup() %>%
  filter(term %in% c("kler", "ksidz", "ksi偶a", "ks.", "biskup", "arcybiskup", "kocio", "smarzowski", "gajos", "kulik", "jakubik", "braciak", "wickiewicz")) %>% 
  spread(created_at, tf)
```

```{r tf_idf_plot, include = TRUE}
selectInput(inputId = "xax",
            label = "Co ma by na osi x?",
            choices = colnames(table)[-1])
selectInput(inputId = "yax",
            label = "Co ma by na osi y?",
            choices = colnames(table)[-1])

renderPlot({
  table %>%
  select(term, input$xax, input$yax) %>%
  filter(!is.na(input$xax) & !is.na(input$yax)) %>%
  ggplot(aes(input$xax, input$yax)) +
  geom_text(aes(label = term)) +
  scale_x_log10(limits=c(0.0001,.2)) +
  scale_y_log10(limits=c(0.0001,.2)) +
  geom_abline(color = "red") +
  theme_classic() +
  labs(title = "Prawdopodobiestwo kluczowych s贸w dla 7 i 17 pa藕dziernika",
    subtitle = "",
    caption = "")
})
```
<!-- CSS styling -->
<style>
    html {
        height: 100%;
        font-size: 62.5%;
    }
    body {
        text-align: justify;
        height: 100%;
        font-size: 1.6em;
        font-family: "Trebuchet MS", "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", sans-serif;
    }
    h1, h2, h3 {
        text-align: left;
    }
    h4.author, h4.date {
        margin: 0.75em 0 0 0;
        text-align: center;
    }
    h2, h3, h4, h5, h6 {
        margin: 2em 0 1em 0;
    }
    div#header {
        margin: 1em 0 1em 0;
    }
    hr {
        margin: 2em 0 2em 0;
    }
    pre {
        margin-bottom: 2em;
    }
</style>